const prune = require('../prune');
const expect = require('chai').expect;
const _ = require('lodash');

const sections = _.mapValues({
  activity: [ // {
'  5/03/6                        1  PUT  AUG 16 LIVE CATTLE   1080  B     NET PREM  US                           858.99',
'                                   GLOBEX TRADE',
'  5/03/6                       11  PUT  OCT 16 LIVE CATTLE   1080  B     NET PREM  US                        11,978.89',
'                                   GLOBEX TRADE',
'  5/05/6                        1  PUT  JUN 17 LIVE CATTLE   1000  B     NET PREM  US                         1,178.99',
'                                   GLOBEX TRADE',
'  5/05/6                        6  PUT  DEC 16 LIVE CATTLE   1060  B     NET PREM  US                         4,913.94',
'                                   GLOBEX TRADE',
'  5/05/6                        4  PUT  FEB 17 LIVE CATTLE   1060  B     NET PREM  US                         4,155.96',
'                                   GLOBEX TRADE',
'  5/05/6                        7  PUT  APR 17 LIVE CATTLE   1060  B     NET PREM  US                         8,602.93',
'                                   GLOBEX TRADE',
'  5/05/6             2          2  CALL JUN 17 LIVE CATTLE   1220  B     MEMO P&L  US',
'                                   GLOBEX TRADE',
'  5/05/6             2             CALL JUN 17 LIVE CATTLE   1220  B     NET PREM  US         880.02',
'                                   GLOBEX TRADE',
'  5/05/6                           Ach Sent                                  CASH  US      50,000.00',
'  5/09/6             1             PUT  APR 17 LIVE CATTLE   1160  B     NET PREM  US       2,451.01',
'                                   GLOBEX TRADE',
'  5/09/6                        1  CALL APR 17 LIVE CATTLE   1260  B     NET PREM  US                           808.99',
'                                   GLOBEX TRADE',
'  5/11/6             2          2  CALL JUN 17 LIVE CATTLE   1220  B     MEMO P&L  US',
'                                   GLOBEX TRADE',
'  5/11/6             2             CALL JUN 17 LIVE CATTLE   1220  B     NET PREM  US         940.02',
'                                   GLOBEX TRADE',
'  5/12/6             4          4  CALL DEC 16 LIVE CATTLE   1260  B     MEMO P&L  US',
'                                   GLOBEX TRADE',
'  5/12/6             4             CALL DEC 16 LIVE CATTLE   1260  B     NET PREM  US       2,160.04',
'                                   GLOBEX TRADE',
'  5/10/6                        9  PUT  DEC 16 CORN           350  A     NET PREM  US                         6,335.91',
'                                   GLOBEX TRADE',
'  5/10/6             9             CALL DEC 16 CORN           400  A     NET PREM  US       9,414.09',
'                                   GLOBEX TRADE',
'  5/25/6            10         10  DEC 16 CORN                     A          P&L  US                         4,625.00',
'                                   GLOBEX TRADE',
'  5/25/6                       10  DEC 16 CORN                     A     FEE/COMM  US         105.10',
'                                   GLOBEX TRADE',
'  5/11/6             1          1  CALL NOV 16 SOYBEANS      1200  A     MEMO P&L  US',
'                                   GLOBEX TRADE',
'  5/11/6             1             CALL NOV 16 SOYBEANS      1200  A     NET PREM  US       1,887.51',
'                                   GLOBEX TRADE',
'  5/11/6                        1  CALL NOV 16 SOYBEANS      1300  A     NET PREM  US                         1,191.49',
'                                   GLOBEX TRADE',
  ], // }
  positions: [ // {
'  5/05/6                        1  PUT  JUN 17 LIVE CATTLE   1000  B     3.00      US       1,210.00',
'                                1*      OPTION MARKET VALUE              3.02 1/2           1,210.00*',
'                                                  EXPIRE  6/02/17',
'                                   AVERAGE SHORT:     3.00000',
'                                 LAST TRADE DATE:   6/02/17',
'  5/05/6                        6  PUT  DEC 16 LIVE CATTLE   1060  B     2.10      US       4,260.00',
'                                6*      OPTION MARKET VALUE              1.77 1/2           4,260.00*',
'                                                  EXPIRE 12/02/16',
'                                   AVERAGE SHORT:     2.10000',
'                                 LAST TRADE DATE:  12/02/16',
'  5/05/6                        4  PUT  FEB 17 LIVE CATTLE   1060  B     2.65      US       3,640.00',
'                                4*      OPTION MARKET VALUE              2.27 1/2           3,640.00*',
'                                                  EXPIRE  2/03/17',
'                                   AVERAGE SHORT:     2.65000',
'                                 LAST TRADE DATE:   2/03/17',
'  5/05/6                        7  PUT  APR 17 LIVE CATTLE   1060  B     3.12 1/2  US       8,260.00',
'                                7*      OPTION MARKET VALUE              2.95               8,260.00*',
'                                                  EXPIRE  4/07/17',
'                                   AVERAGE SHORT:     3.12500',
'                                 LAST TRADE DATE:   4/07/17',
'  5/03/6                        1  PUT  AUG 16 LIVE CATTLE   1080  B     2.20      US         300.00',
'                                1*      OPTION MARKET VALUE               .75                 300.00*',
'                                                  EXPIRE  8/05/16',
'                                   AVERAGE SHORT:     2.20000',
'                                 LAST TRADE DATE:   8/05/16',
'  5/03/6                       11  PUT  OCT 16 LIVE CATTLE   1080  B     2.77 1/2  US       7,260.00',
'                               11*      OPTION MARKET VALUE              1.65               7,260.00*',
'                                                  EXPIRE 10/07/16',
'                                   AVERAGE SHORT:     2.77500',
'                                 LAST TRADE DATE:  10/07/16',
'  3/08/6             4             PUT  JUN 17 LIVE CATTLE   1120  B     6.95      US                        12,640.00',
'                     4*                 OPTION MARKET VALUE              7.90                                12,640.00*',
'                                    6,000.00  LIM EXPIRE  6/02/17',
'                                   AVERAGE LONG:      6.95000',
'                                 LAST TRADE DATE:   6/02/17',
' 12/15/5             4             PUT  DEC 16 LIVE CATTLE   1160  B     7.37 1/2  US                         8,000.00',
'                     4*                 OPTION MARKET VALUE              5.00                                 8,000.00*',
'                                                  EXPIRE 12/02/16',
'                                   AVERAGE LONG:      7.37500',
'                                 LAST TRADE DATE:  12/02/16',
' 12/15/5            19             PUT  FEB 17 LIVE CATTLE   1160  B     7.90      US                        43,890.00',
'                    19*                 OPTION MARKET VALUE              5.77 1/2                            43,890.00*',
'                                    1,900.00  LIM EXPIRE  2/03/17',
'                                   AVERAGE LONG:      7.90000',
'                                 LAST TRADE DATE:   2/03/17',
'  5/09/6             1             PUT  APR 17 LIVE CATTLE   1160  B     6.07 1/2  US                         2,700.00',
'                     1*                 OPTION MARKET VALUE              6.75                                 2,700.00*',
'                                      600.00  LIM EXPIRE  4/07/17',
'                                   AVERAGE LONG:      6.07500',
'                                 LAST TRADE DATE:   4/07/17',
'  4/28/6             3             PUT  AUG 16 LIVE CATTLE   1180  B     6.97 1/2  US                         4,350.00',
'                     3*                 OPTION MARKET VALUE              3.62 1/2                             4,350.00*',
'                                                  EXPIRE  8/05/16',
'                                   AVERAGE LONG:      6.97500',
'                                 LAST TRADE DATE:   8/05/16',
'  4/28/6            10             PUT  OCT 16 LIVE CATTLE   1180  B     8.00      US                        20,500.00',
'                    10*                 OPTION MARKET VALUE              5.12 1/2                            20,500.00*',
'                                    2,700.00  LIM EXPIRE 10/07/16',
'                                   AVERAGE LONG:      8.00000',
'                                 LAST TRADE DATE:  10/07/16',
'  2/17/6             8             PUT  APR 17 LIVE CATTLE   1180  B     8.10      US                        25,040.00',
'                     8*                 OPTION MARKET VALUE              7.82 1/2                            25,040.00*',
'                                   11,200.00  LIM EXPIRE  4/07/17',
'                                   AVERAGE LONG:      8.10000',
'                                 LAST TRADE DATE:   4/07/17',
'  4/28/6             4             PUT  OCT 16 LIVE CATTLE   1200  B     9.22 1/2  US                         9,880.00',
'                     4*                 OPTION MARKET VALUE              6.17 1/2                             9,880.00*',
'                                    4,280.00  LIM EXPIRE 10/07/16',
'                                   AVERAGE LONG:      9.22500',
'                                 LAST TRADE DATE:  10/07/16',
' 12/21/5             3             PUT  DEC 16 LIVE CATTLE   1200  B     7.00      US                         8,430.00',
' 12/21/5             1             PUT  DEC 16 LIVE CATTLE   1200  B     7.20      US                         2,810.00',
'                     4*                 OPTION MARKET VALUE              7.02 1/2                            11,240.00*',
'                                    5,080.00  LIM EXPIRE 12/02/16',
'                                   AVERAGE LONG:      7.05000',
'                                 LAST TRADE DATE:  12/02/16',
'  3/10/6            22             PUT  APR 17 LIVE CATTLE   1200  B     6.95      US                        79,200.00',
'                    22*                 OPTION MARKET VALUE              9.00                                79,200.00*',
'                                   48,400.00  LIM EXPIRE  4/07/17',
'                                   AVERAGE LONG:      6.95000',
'                                 LAST TRADE DATE:   4/07/17',
'  4/28/6             9             PUT  OCT 16 LIVE CATTLE   1220  B    10.32 1/2  US                        26,550.00',
'                     9*                 OPTION MARKET VALUE              7.37 1/2                            26,550.00*',
'                                   16,830.00  LIM EXPIRE 10/07/16',
'                                   AVERAGE LONG:     10.32500',
'                                 LAST TRADE DATE:  10/07/16',
' 11/23/5             7             PUT  DEC 16 LIVE CATTLE   1240  B     6.55      US                        26,670.00',
'  1/04/6             9             PUT  DEC 16 LIVE CATTLE   1240  B     6.45      US                        34,290.00',
'                    16*                 OPTION MARKET VALUE              9.52 1/2                            60,960.00*',
'                                   45,920.00  LIM EXPIRE 12/02/16',
'                                   AVERAGE LONG:      6.49375',
'                                 LAST TRADE DATE:  12/02/16',
'  5/09/6                        1  CALL APR 17 LIVE CATTLE   1260  B     2.07 1/2  US         690.00',
'                                1*      OPTION MARKET VALUE              1.72 1/2             690.00*',
'                                                  EXPIRE  4/07/17',
'                                   AVERAGE SHORT:     2.07500',
'                                 LAST TRADE DATE:   4/07/17',
' 12/15/5                       19  CALL FEB 17 LIVE CATTLE   1280  B     2.20      US      10,450.00',
'                               19*      OPTION MARKET VALUE              1.37 1/2          10,450.00*',
'                                                  EXPIRE  2/03/17',
'                                   AVERAGE SHORT:     2.20000',
'                                 LAST TRADE DATE:   2/03/17',
'  5/10/6                        9  PUT  DEC 16 CORN           350  A      .14 1/2  US       3,375.00',
'                                9*      OPTION MARKET VALUE               .07 1/2           3,375.00*',
'                                                  EXPIRE 11/25/16',
'                                   AVERAGE SHORT:      .14500',
'                                 LAST TRADE DATE:  11/25/16',
'  5/10/6             9             CALL DEC 16 CORN           400  A      .20 1/2  US                        15,412.50',
'                     9*                 OPTION MARKET VALUE               .34 1/4                            15,412.50*',
'                                    3,825.00  LIM EXPIRE 11/25/16',
'                                   AVERAGE LONG:       .20500',
'                                 LAST TRADE DATE:  11/25/16',
'  4/26/6             1             PUT  NOV 16 SOYBEANS       960  A      .34 1/4  US                           806.25',
'                     1*                 OPTION MARKET VALUE               .16 1/8                               806.25*',
'                                                  EXPIRE 10/21/16',
'                                   AVERAGE LONG:       .34250',
'                                 LAST TRADE DATE:  10/21/16',
'  5/11/6                        1  CALL NOV 16 SOYBEANS      1300  A      .24 1/4  US         643.75',
'                                1*      OPTION MARKET VALUE               .12 7/8             643.75*',
'                                                  EXPIRE 10/21/16',
'                                   AVERAGE SHORT:      .24250',
'                                 LAST TRADE DATE:  10/21/16',
'  9/24/4            10             DEC 16 CORN                     A     3.97 3/4  US       1,250.00',
'                    10*                 OPEN TRADE EQUITY                3.95 1/4           1,250.00*',
'                                   AVERAGE LONG:      3.97750',
  ], // }
  summary: [
'  1. BEGINNING ACCT BALANCE            90,122.69',
'  2. P&L AND CASH ACTIVITY             23,932.40-',
'  3. ENDING ACCT BALANCE               66,190.29',
'  4. NET FUTURES P&L                    4,519.90',
'  5. NET OPTION PREMIUM                26,067.60',
'  8. OPTIONS MARKET VALUE             268,880.00',
'  9. ACCT VALUE AT MARKET             335,070.29',
' 11. CONVERTED ACCT VALUE US          335,070.29',
'                                     *** CURRENT MONTH ***  *** YEAR-TO-DATE ***',
' FUTURES P&L                   US              4,519.90              4,519.90',
' OPTION PREMIUM                US             26,067.60            113,519.26-',
'          * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *',
'          * ADMIS HAS IMPLEMENTED A $2.00 HARD COPY MAILED STATEMENT FEE. *',
'          * TO AVOID THIS FEE, PLEASE CONTACT US AT GOGREEN@ADMIS.COM     *',
'          * FOR INFORMATION ON RECEIVING YOUR STATEMENTS VIA EMAIL.       *',
'          * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *',
  ],
},(sec) => _.map(sec,(line,lineno) => { return {line,lineno,acct:'test',stmt:'test'}; }));

const expected_sections = _.mapValues({
  activity: [
    {lineno:0, line: '  5/03/6                        1  PUT  AUG 16 LIVE CATTLE   1080  B     NET PREM  US                           858.99'},
    {lineno:2, line: '  5/03/6                       11  PUT  OCT 16 LIVE CATTLE   1080  B     NET PREM  US                        11,978.89'},
    {lineno:4, line: '  5/05/6                        1  PUT  JUN 17 LIVE CATTLE   1000  B     NET PREM  US                         1,178.99'},
    {lineno:6, line: '  5/05/6                        6  PUT  DEC 16 LIVE CATTLE   1060  B     NET PREM  US                         4,913.94'},
    {lineno:8, line: '  5/05/6                        4  PUT  FEB 17 LIVE CATTLE   1060  B     NET PREM  US                         4,155.96'},
    {lineno:10,line: '  5/05/6                        7  PUT  APR 17 LIVE CATTLE   1060  B     NET PREM  US                         8,602.93'},
    {lineno:14,line: '  5/05/6             2             CALL JUN 17 LIVE CATTLE   1220  B     NET PREM  US         880.02'},
    {lineno:16,line: '  5/05/6                           Ach Sent                                  CASH  US      50,000.00'},
    {lineno:17,line: '  5/09/6             1             PUT  APR 17 LIVE CATTLE   1160  B     NET PREM  US       2,451.01'},
    {lineno:19,line: '  5/09/6                        1  CALL APR 17 LIVE CATTLE   1260  B     NET PREM  US                           808.99'},
    {lineno:23,line: '  5/11/6             2             CALL JUN 17 LIVE CATTLE   1220  B     NET PREM  US         940.02'},
    {lineno:27,line: '  5/12/6             4             CALL DEC 16 LIVE CATTLE   1260  B     NET PREM  US       2,160.04'},
    {lineno:29,line: '  5/10/6                        9  PUT  DEC 16 CORN           350  A     NET PREM  US                         6,335.91'},
    {lineno:31,line: '  5/10/6             9             CALL DEC 16 CORN           400  A     NET PREM  US       9,414.09'},
    {lineno:33,line: '  5/25/6            10         10  DEC 16 CORN                     A          P&L  US                         4,625.00'},
    {lineno:35,line: '  5/25/6                       10  DEC 16 CORN                     A     FEE/COMM  US         105.10'},
    {lineno:39,line: '  5/11/6             1             CALL NOV 16 SOYBEANS      1200  A     NET PREM  US       1,887.51'},
    {lineno:41,line: '  5/11/6                        1  CALL NOV 16 SOYBEANS      1300  A     NET PREM  US                         1,191.49'},
  ],
  positions: [
    {lineno:0,  line: '  5/05/6                        1  PUT  JUN 17 LIVE CATTLE   1000  B     3.00      US       1,210.00'},
    {lineno:5,  line: '  5/05/6                        6  PUT  DEC 16 LIVE CATTLE   1060  B     2.10      US       4,260.00'},
    {lineno:10, line: '  5/05/6                        4  PUT  FEB 17 LIVE CATTLE   1060  B     2.65      US       3,640.00'},
    {lineno:15, line: '  5/05/6                        7  PUT  APR 17 LIVE CATTLE   1060  B     3.12 1/2  US       8,260.00'},
    {lineno:20, line: '  5/03/6                        1  PUT  AUG 16 LIVE CATTLE   1080  B     2.20      US         300.00'},
    {lineno:25, line: '  5/03/6                       11  PUT  OCT 16 LIVE CATTLE   1080  B     2.77 1/2  US       7,260.00'},
    {lineno:30, line: '  3/08/6             4             PUT  JUN 17 LIVE CATTLE   1120  B     6.95      US                        12,640.00'},
    {lineno:35, line: ' 12/15/5             4             PUT  DEC 16 LIVE CATTLE   1160  B     7.37 1/2  US                         8,000.00'},
    {lineno:40, line: ' 12/15/5            19             PUT  FEB 17 LIVE CATTLE   1160  B     7.90      US                        43,890.00'},
    {lineno:45, line: '  5/09/6             1             PUT  APR 17 LIVE CATTLE   1160  B     6.07 1/2  US                         2,700.00'},
    {lineno:50, line: '  4/28/6             3             PUT  AUG 16 LIVE CATTLE   1180  B     6.97 1/2  US                         4,350.00'},
    {lineno:55, line: '  4/28/6            10             PUT  OCT 16 LIVE CATTLE   1180  B     8.00      US                        20,500.00'},
    {lineno:60, line: '  2/17/6             8             PUT  APR 17 LIVE CATTLE   1180  B     8.10      US                        25,040.00'},
    {lineno:65, line: '  4/28/6             4             PUT  OCT 16 LIVE CATTLE   1200  B     9.22 1/2  US                         9,880.00'},
    {lineno:70, line: ' 12/21/5             3             PUT  DEC 16 LIVE CATTLE   1200  B     7.00      US                         8,430.00'},
    {lineno:71, line: ' 12/21/5             1             PUT  DEC 16 LIVE CATTLE   1200  B     7.20      US                         2,810.00'},
    {lineno:76, line: '  3/10/6            22             PUT  APR 17 LIVE CATTLE   1200  B     6.95      US                        79,200.00'},
    {lineno:81, line: '  4/28/6             9             PUT  OCT 16 LIVE CATTLE   1220  B    10.32 1/2  US                        26,550.00'},
    {lineno:86, line: ' 11/23/5             7             PUT  DEC 16 LIVE CATTLE   1240  B     6.55      US                        26,670.00'},
    {lineno:87, line: '  1/04/6             9             PUT  DEC 16 LIVE CATTLE   1240  B     6.45      US                        34,290.00'},
    {lineno:92, line: '  5/09/6                        1  CALL APR 17 LIVE CATTLE   1260  B     2.07 1/2  US         690.00'},
    {lineno:97, line: ' 12/15/5                       19  CALL FEB 17 LIVE CATTLE   1280  B     2.20      US      10,450.00'},
    {lineno:102,line: '  5/10/6                        9  PUT  DEC 16 CORN           350  A      .14 1/2  US       3,375.00'},
    {lineno:107,line: '  5/10/6             9             CALL DEC 16 CORN           400  A      .20 1/2  US                        15,412.50'},
    {lineno:112,line: '  4/26/6             1             PUT  NOV 16 SOYBEANS       960  A      .34 1/4  US                           806.25'},
    {lineno:117,line: '  5/11/6                        1  CALL NOV 16 SOYBEANS      1300  A      .24 1/4  US         643.75'},
    {lineno:122,line: '  9/24/4            10             DEC 16 CORN                     A     3.97 3/4  US       1,250.00'},
  ],
  summary: [
    {lineno:0, line:'  1. BEGINNING ACCT BALANCE            90,122.69'},
    {lineno:1, line:'  2. P&L AND CASH ACTIVITY             23,932.40-'},
    {lineno:2, line:'  3. ENDING ACCT BALANCE               66,190.29'},
    {lineno:3, line:'  4. NET FUTURES P&L                    4,519.90'},
    {lineno:4, line:'  5. NET OPTION PREMIUM                26,067.60'},
    {lineno:5, line:'  8. OPTIONS MARKET VALUE             268,880.00'},
    {lineno:6, line:'  9. ACCT VALUE AT MARKET             335,070.29'},
    {lineno:7, line:' 11. CONVERTED ACCT VALUE US          335,070.29'},
  ],
},(sec) => _.map(sec,({line,lineno}) => { return {line,lineno,acct:'test',stmt:'test'}; }));

describe('prune', () => {
  
  let result = prune(sections);

  it('activity should equal expected',  () => expect(result.activity).to.deep.equal(expected_sections.activity));
  it('positions should equal expected', () => expect(result.positions).to.deep.equal(expected_sections.positions));
  it('summary should equal expected',   () => expect(result.summary).to.deep.equal(expected_sections.summary));

});
